{"version":3,"sources":["const/cell-value.js","const/cell-state.js","utils/check-cell.js","components/Cell/Cell.js","components/Field/Field.js","components/Footer/Footer.js","components/Header/Header.js","view-models/cell-address-utils.js","view-models/cell-neighbors-utils.js","components/Indicators/Indicators.js","hooks/use-interval.js","components/Minesweeper/Minesweeper.js","hooks/use-field.js","hooks/use-did-update.js","App.js","setupIcons.js","index.js"],"names":["cellValue","cellState","Hidden","Visible","Flagged","checkCell","cell","prop","criteria","isMinedCell","isHiddenCell","isFlaggedCell","isBustedCell","Cell","memo","cellRevealHandler","flagPlantingHandler","neighborsRevealHandler","value","hasGuessedIncorrectly","hasBustedMine","className","onClick","onContextMenu","icon","onMouseDown","Field","width","disabled","field","handleNeighborsReveal","address","target","which","nativeEvent","addEventListener","handleMouseup","event","removeEventListener","style","gridTemplateColumns","preventDefault","map","key","Footer","href","rel","Date","getFullYear","Header","CellAddressUtils","fieldWidth","this","_fieldWidth","rowAddress","colAddress","CellNeighborsUtils","fieldHeight","_fieldHeight","_cellAddressUtils","state","getAddresses","some","adr","to2DAddresses","addresses","rowAddressOffset","colAddressOffset","rowAddressAhead","colAddressAhead","_doesAddressExist","push","to1DAddress","_getCountBy","getMinedCount","reduce","ac","Indicators","minesCount","smileyFaceClickHandler","isCountingSeconds","isBust","isVictory","useState","secondsCount","setSecondsCount","formatCount","count","fn","delay","fnRef","useRef","useEffect","current","intervalId","setInterval","clearInterval","useInterval","Minesweeper","fieldDimension","isInit","setIsInit","setIsBust","setIsVictory","hiddenMinesCount","setHiddenMinesCount","height","length","cellNeighborsUtils","useMemo","emptyField","Array","fill","setField","getFloodFilledField","draftFn","produce","draft","floodFill","cellAdr","canFloodFill","forEach","getBustedField","reset","init","difference","range","randomAddresses","Set","size","add","Math","random","revealCell","plantFlag","revealNeighbors","canRevealNeighbors","markMines","useField","didMount","deps","useDidUpdate","reject","App","library","faGithub","faBomb","faFlag","faMeh","faFrown","faSmile","render","document","getElementById"],"mappings":"wNAAaA,GACE,EADFA,GAEM,EAFNA,GAGJ,EAHIA,EAIJ,ECJIC,EAAY,CACvBC,OAAQ,EACRC,QAAS,EACTC,QAAS,GCDLC,EAAY,SAACC,EAAMC,EAAMC,GAAb,OAA0BF,EAAKC,KAAUC,GAE9CC,EAAc,SAAAH,GAAI,OAAID,EAAUC,EAAM,QAASN,IAC/CU,EAAe,SAAAJ,GAAI,OAAID,EAAUC,EAAM,QAASL,EAAUC,SAC1DS,EAAgB,SAAAL,GAAI,OAAID,EAAUC,EAAM,QAASL,EAAUG,UAC3DQ,EAAe,SAAAN,GAAI,OAAID,EAAUC,EAAM,QAASN,ICGhDa,G,MAAOC,gBAAK,YAA+E,IAA5ER,EAA2E,EAA3EA,KAAMS,EAAqE,EAArEA,kBAAmBC,EAAkD,EAAlDA,oBAAqBC,EAA6B,EAA7BA,uBAChEC,EAAUZ,EAAVY,MAEFC,EAAwBD,IAAUlB,EAClCoB,EAAgBR,EAAaN,GAEnC,OAAII,EAAaJ,GAAc,yBAC7Be,UAAU,OACVC,QAASP,EACTQ,cAAeP,IAGbL,EAAcL,GAAc,yBAAKe,UAAU,OAAOE,cAAeP,GACnE,kBAAC,IAAD,CAAiBQ,KAAM,CAAC,MAAO,WAG7BN,IAAUlB,EAAwB,yBAAKqB,UAAU,uBAEjDZ,EAAYH,IAASa,GAAyBC,EAAsB,yBACtEC,UAAS,eAAUF,EAAwB,wBAA0BC,EAAgB,oBAAsB,KAE3G,kBAAC,IAAD,CAAiBI,KAAM,CAAC,MAAO,WAG1B,yBAAKH,UAAS,4CAAuCH,GAASO,YAAaR,GAC/EC,OC7BQQ,G,MAAQ,SAAC,GAAgG,IAA9FC,EAA6F,EAA7FA,MAAOC,EAAsF,EAAtFA,SAAUC,EAA4E,EAA5EA,MAAOd,EAAqE,EAArEA,kBAAmBC,EAAkD,EAAlDA,oBAAqBC,EAA6B,EAA7BA,uBAChFa,EAAwB,SAAC,EAAoCC,GAAa,IAA/CC,EAA8C,EAA9CA,OAAuBC,EAAuB,EAAtCC,YAAeD,MACtD,IAAKL,EAAU,CAObI,EAAOG,iBAAiB,WANF,SAAhBC,EAAgBC,GACpBJ,IAAUI,EAAMJ,OAAShB,EAAuBc,GAEhDC,EAAOM,oBAAoB,UAAWF,QAO5C,OAAO,yBACLf,UAAS,eAAUO,EAAW,YAAc,IAC5CW,MAAO,CAACC,oBAAoB,UAAD,OAAYb,EAAZ,WAC3BJ,cAAe,SAAAc,GAAWA,EAAMI,mBAE/BZ,EAAMa,KAAI,SAACpC,EAAMyB,GAAP,OAAmB,kBAAC,EAAD,CAC5BY,IAAKZ,EACLzB,KAAMA,EACNS,kBAAmB,YAASa,GAAYb,EAAkBT,EAAMyB,IAChEf,oBAAqB,YAASY,GAAYZ,EAAoBV,EAAMyB,IACpEd,uBAAwB,SAAAoB,GAAWP,EAAsBO,EAAON,YCvBzDa,G,MAAS,kBAAM,gCAC1B,2CAEE,uBAAGC,KAAK,kCAAkCb,OAAO,SAASc,IAAI,uBAC5D,kBAAC,IAAD,CAAiBtB,KAAM,CAAC,MAAO,aAHnC,OAKQ,+BAAO,IAAIuB,MAAOC,mBCNfC,G,MAAS,kBAAM,gCAC1B,0BAAM5B,UAAU,SAAhB,eAEA,uBAAGwB,KAAK,8CAA8Cb,OAAO,SAASc,IAAI,uBACxE,kBAAC,IAAD,CAAiBtB,KAAM,CAAC,MAAO,gB,yECVtB0B,EAAb,WAGE,WACEC,GACC,oBACDC,KAAKC,YAAcF,EANvB,0DASgBpB,GACZ,IAAMuB,EAAavB,EAAUqB,KAAKC,YAElC,MAAO,CAACC,GAAavB,EAAUuB,GAAcF,KAAKC,eAZtD,kCAecC,EAAYC,GACtB,OAAOA,EAAaH,KAAKC,YAAcC,MAhB3C,KCIaE,EAAb,WAKE,WACEL,EACAM,GACC,oBACDL,KAAKC,YAAcF,EACnBC,KAAKM,aAAeD,EACpBL,KAAKO,kBAAoB,IAAIT,EAAiBC,GAXlD,yDAceS,EAAO7B,GAClB,OAAQqB,KAAKS,aAAa9B,GAAS+B,MAAK,SAAAC,GACtC,IAAMzD,EAAOsD,EAAMG,GAEnB,OAAOtD,EAAYH,KAAUK,EAAcL,QAlBjD,mCAsBeyB,GAIX,IAJqB,IAAD,EACaqB,KAAKO,kBAAkBK,cAAcjC,GADlD,mBACbuB,EADa,KACDC,EADC,KAEdU,EAAY,GAETC,GAAoB,EAAGA,EAAmB,EAAGA,IACpD,IAAK,IAAIC,GAAoB,EAAGA,EAAmB,EAAGA,IACpD,GAAID,GAAoBC,EAAkB,CACxC,IAAMC,EAAkBd,EAAaY,EAC/BG,EAAkBd,EAAaY,EAErCf,KAAKkB,kBAAkBF,EAAiBhB,KAAKC,cACxCD,KAAKkB,kBAAkBD,EAAiBjB,KAAKM,eAC3CO,EAAUM,KAAKnB,KAAKO,kBAAkBa,YAAYJ,EAAiBC,IAGhF,OAAOJ,IArCX,oCAwCgBL,EAAO7B,GACnB,OAAOqB,KAAKqB,YAAYb,EAAO7B,EAAStB,KAzC5C,yCA4CqBmD,EAAO7B,GACxB,OAAOqB,KAAKsB,cAAcd,EAAO7B,KAAaqB,KAAKqB,YAAYb,EAAO7B,EAASpB,KA7CnF,kCAgDciD,EAAO7B,EAASvB,GAC1B,OAAO4C,KAAKS,aAAa9B,GAAS4C,QAAO,SAACC,EAAIb,GAAL,OAAavD,EAASoD,EAAMG,IAAQa,EAAK,EAAIA,IAAI,KAjD9F,wCAoDoB7C,EAASvB,GACzB,OAAQ,EAAIuB,GAAWA,EAAUvB,MArDrC,KCIaqE,G,OAAa,SAAC,GAAkF,IAAhFC,EAA+E,EAA/EA,WAAYC,EAAmE,EAAnEA,uBAAwBC,EAA2C,EAA3CA,kBAAmBC,EAAwB,EAAxBA,OAAQC,EAAgB,EAAhBA,UAAgB,EAClEC,mBAAS,GADyD,mBACnGC,EADmG,KACrFC,EADqF,KAGpGC,EAAc,SAAAC,GAClB,OAAIA,EAAQ,EAAU,MAClBA,EAAQ,GAAU,KAAN,OAAYA,GACxBA,EAAQ,IAAW,IAAN,OAAWA,GAEtB,GAAN,OAAUA,IAYZ,OC1ByB,SAACC,EAAIC,GAC9B,IAAMC,EAAQC,mBAEdC,qBAAU,WACRF,EAAMG,QAAUL,IACf,CAACA,IAEJI,qBAAU,WACR,GAAIH,EAAO,CACT,IAAMK,EAAaC,aAAY,WAC7BL,EAAMG,YACLJ,GAEH,OAAO,WACLO,cAAcF,OAGjB,CAACL,IDKJQ,EAAY,WACVZ,EAAgBD,EAAe,KAC9BJ,EAAoB,IAAM,MAEtB,yBAAK3D,UAAU,cACpB,yBAAKA,UAAU,eAAeiE,EAAYR,IAC1C,yBAAKzD,UAAU,cAAcC,QAXD,WAC5B+D,EAAgB,GAChBN,MAUE,kBAAC,IAAD,CAAiBvD,KAAM,CAAC,MAAO0D,EAAY,QAAUD,EAAS,QAAU,UAE1E,yBAAK5D,UAAU,SAASiE,EAAYF,O,iBErB3Bc,G,OAAc,SAAC,GAAoC,IAAlCpB,EAAiC,EAAjCA,WAAYqB,EAAqB,EAArBA,eAAqB,EACjChB,oBAAS,GADwB,mBACtDiB,EADsD,KAC9CC,EAD8C,OAEjClB,oBAAS,GAFwB,mBAEtDF,EAFsD,KAE9CqB,EAF8C,OAG3BnB,oBAAS,GAHkB,mBAGtDD,EAHsD,KAG3CqB,EAH2C,OAIbpB,mBAASL,GAJI,mBAItD0B,EAJsD,KAIpCC,EAJoC,OCCvC,SAAC,GAAmC,IAAjC9E,EAAgC,EAAhCA,MAAO+E,EAAyB,EAAzBA,OAAQ5B,EAAiB,EAAjBA,WAClC6B,EAAShF,EAAQ+E,EAEjBE,EAAqBC,mBAAQ,kBAAM,IAAIrD,EAAmB7B,EAAO+E,KAAS,CAACC,IAC3EG,EAAaD,mBAAQ,kBAAME,MAAMJ,GAAQK,KAAK,CAAE9F,MAAOlB,EAAiB4D,MAAO3D,EAAUC,WAAW,CAACyG,IAJlD,EAM/BxB,mBAAS2B,GANsB,mBAMlDjF,EANkD,KAM3CoF,EAN2C,KAQnDC,EAAsB,SAACnF,EAASoF,GAAV,OAAsBC,YAAQvF,GAAO,SAAAwF,GAC9B,OAAPF,QAAO,IAAPA,KAAUE,GACpCA,EAAMtF,GAAS6B,MAAQ3D,EAAUE,SAEf,SAAZmH,EAAYC,GAChBX,EAAmBY,aAAaH,EAAOE,IAAYX,EAAmB/C,aAAa0D,GAASE,SAAQ,SAAA1D,GAClG,IAAMzD,EAAO+G,EAAMtD,GAEdtD,EAAYH,KAASI,EAAaJ,IAAUK,EAAcL,KAC7DA,EAAKsD,MAAQ3D,EAAUE,QAEvBmH,EAAUvD,OAKhBuD,CAAUvF,OAGN2F,EAAiB,SAAAP,GAAO,OAAIC,YAAQvF,GAAO,SAAAwF,GAC/CF,EAAQE,GACRA,EAAMI,SAAQ,SAACnH,EAAMyD,GACnBtD,EAAYH,KAAUK,EAAcL,KAAUA,EAAKsD,MAAQ3D,EAAUE,UACpEM,EAAYH,IAASK,EAAcL,KAAU+G,EAAMtD,GAAO,CACzD7C,MAAOlB,EACP4D,MAAO3D,EAAUE,iBA4DvB,MAAO,CAAE0B,QAAO8F,MAvDF,WACZV,EAASH,IAsDYc,KAnDV,SAAA7F,GACXkF,EAASC,EAAoBnF,GAAS,SAAAsF,GAIpC,IAHA,IAAMpD,EAAY4D,IAAWC,IAAMnB,GAAP,CAAiB5E,GAAjB,mBAA6B6E,EAAmB/C,aAAa9B,MACnFgG,EAAkB,IAAIC,IAErBD,EAAgBE,KAAOnD,GAAYiD,EAAgBG,IAAIjE,EAAUkE,KAAKC,SAAWnE,EAAU0C,OAAS,IAE3GoB,EAAgBN,SAAQ,SAAA1D,GACtBsD,EAAMtD,GAAK7C,MAAQlB,KAGrBqH,EAAMI,SAAQ,SAACnH,EAAMyD,IAClBtD,EAAYH,KAAUA,EAAKY,MAAQ0F,EAAmBlC,cAAc2C,EAAOtD,YAuCrDsE,WAlCV,SAAC/H,EAAMyB,GACxBkF,EAASxG,EAAYH,GAAQoH,GAAe,SAAAL,GAC1CA,EAAMtF,GAAW,CAAEb,MAAOlB,EAAsB4D,MAAO3D,EAAUE,YAC9D+G,EAAoBnF,KA+BcuG,UA5BvB,SAAChI,EAAMyB,GACvBkF,EAASG,YAAQvF,GAAO,SAAAwF,GACtBA,EAAMtF,GAAS6B,MAAQ3D,EAAUU,EAAcL,GAAQ,SAAW,gBA0BlBiI,gBAtB5B,SAAAxG,GAClB6E,EAAmBY,aAAa3F,EAAOE,GAAUkF,EAASC,EAAoBnF,IACzE6E,EAAmB4B,mBAAmB3G,EAAOE,IAAUkF,EAASS,GAAe,SAAAL,GACtFT,EAAmB/C,aAAa9B,GAAS0F,SAAQ,SAAA1D,GAC/C,IAAMzD,EAAO+G,EAAMtD,GAEnBtD,EAAYH,KAAUK,EAAcL,KAAUA,EAAKY,MAAQlB,IAC1DS,EAAYH,IAASK,EAAcL,KAAUA,EAAKY,MAAQlB,GAE3DM,EAAKsD,MAAQ3D,EAAUE,gBAawCsI,UARnD,WAChBxB,EAASG,YAAQvF,GAAO,SAAAwF,GACtBA,EAAMI,SAAQ,SAAAnH,GACZG,EAAYH,KAAUA,EAAKsD,MAAQ3D,EAAUG,kBD3E/CsI,CAAS,CAAE5D,aAAYnD,MAAOwE,EAAgBO,OAAQP,IAPxDtE,EAP2D,EAO3DA,MACA8F,EAR2D,EAQ3DA,MACAC,EAT2D,EAS3DA,KACAS,EAV2D,EAU3DA,WACAC,EAX2D,EAW3DA,UACAC,EAZ2D,EAY3DA,gBACAE,EAb2D,EAa3DA,UAgCF,OEvD0B,SAACjD,GAC3B,IAAME,EAAQC,mBACRgD,EAAWhD,kBAAO,GAExBC,qBAAU,WACRF,EAAMG,QAAUL,IACf,CAACA,IANuC,2BAAToD,EAAS,iCAATA,EAAS,kBAQ3ChD,qBAAU,WACJ+C,EAAS9C,QAASH,EAAMG,UACvB8C,EAAS9C,SAAU,IACvB+C,GFoCHC,EAAa,WACPhH,EAAMiC,KAAKlD,GAAe0F,GAAU,GAC9BwC,IAAOjH,EAAOpB,GAAaqD,KAAKpD,KACxC+H,IACAlC,GAAa,MAEd1E,GAEI,yBAAKR,UAAU,eACpB,kBAAC,EAAD,CACEyD,WAAY0B,EACZvB,OAAQA,EACRC,UAAWA,EACXF,kBAAmBoB,KAAYnB,GAAUC,GACzCH,uBAtB0B,WAC5B4C,IACAtB,GAAU,GACVC,GAAU,GACVC,GAAa,GACbE,EAAoB3B,MAmBpB,kBAAC,EAAD,CACEnD,MAAOwE,EACPvE,SAAUqD,GAAUC,EACpBrD,MAAOA,EACPd,kBAzCqB,SAACT,EAAMyB,GAC1BqE,EAAQiC,EAAW/H,EAAMyB,IAE3B6F,EAAK7F,GACLsE,GAAU,KAsCVrF,oBAlCuB,SAACV,EAAMyB,GAChCuG,EAAUhI,EAAMyB,GAChB0E,EAAoBD,GAAoB7F,EAAcL,GAAQ,GAAK,KAiCjEW,uBAAwBsH,OGnEjBQ,EAAM,kBAAM,oCACvB,kBAAC,EAAD,MACA,kBAAC,EAAD,CAAajE,WAAY,GAAIqB,eAAgB,KAC7C,kBAAC,EAAD,Q,uCCDA6C,IAAQd,IAAIe,IAAUC,IAAQC,IAAQC,IAAOC,IAASC,KCKxDC,iBACE,kBAAC,aAAD,KACE,kBAAC,EAAD,OAEFC,SAASC,eAAe,U","file":"static/js/main.9f6e91cd.chunk.js","sourcesContent":["export const cellValue = {\r\n  BustedMine: -3,\r\n  IncorrectGuess: -2,\r\n  Mine: -1,\r\n  Empty: 0,\r\n  One: 1,\r\n  Two: 2,\r\n  Three: 3,\r\n  Four: 4,\r\n  Five: 5,\r\n  Six: 6,\r\n  Seven: 7,\r\n  Eight: 8,\r\n};\r\n","export const cellState = {\r\n  Hidden: 0,\r\n  Visible: 1,\r\n  Flagged: 2,\r\n};\r\n","import { cellState, cellValue } from 'const';\r\n\r\nconst checkCell = (cell, prop, criteria) => cell[prop] === criteria;\r\n\r\nexport const isMinedCell = cell => checkCell(cell, 'value', cellValue.Mine);\r\nexport const isHiddenCell = cell => checkCell(cell, 'state', cellState.Hidden);\r\nexport const isFlaggedCell = cell => checkCell(cell, 'state', cellState.Flagged);\r\nexport const isBustedCell = cell => checkCell(cell, 'value', cellValue.BustedMine);\r\n","import React, { memo } from 'react';\r\n\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\n\r\nimport { isBustedCell, isFlaggedCell, isHiddenCell, isMinedCell } from 'utils/check-cell';\r\n\r\nimport { cellValue } from 'const';\r\n\r\nimport './Cell.scss';\r\n\r\nexport const Cell = memo(({ cell, cellRevealHandler, flagPlantingHandler, neighborsRevealHandler }) => {\r\n  const { value } = cell;\r\n\r\n  const hasGuessedIncorrectly = value === cellValue.IncorrectGuess;\r\n  const hasBustedMine = isBustedCell(cell);\r\n\r\n  if (isHiddenCell(cell)) return <div\r\n    className='cell'\r\n    onClick={cellRevealHandler}\r\n    onContextMenu={flagPlantingHandler}\r\n  />;\r\n\r\n  if (isFlaggedCell(cell)) return <div className='cell' onContextMenu={flagPlantingHandler}>\r\n    <FontAwesomeIcon icon={['far', 'flag']} />\r\n  </div>;\r\n\r\n  if (value === cellValue.Empty) return <div className='cell cell__visible' />;\r\n\r\n  if (isMinedCell(cell) || hasGuessedIncorrectly || hasBustedMine) return <div\r\n    className={`cell ${hasGuessedIncorrectly ? 'cell__incorrect-guess' : hasBustedMine ? 'cell__busted-mine' : ''}`}\r\n  >\r\n    <FontAwesomeIcon icon={['fas', 'bomb']} />\r\n  </div>;\r\n\r\n  return <div className={`cell cell__visible cell__visible__${value}`} onMouseDown={neighborsRevealHandler}>\r\n    {value}\r\n  </div>;\r\n});\r\n","import React from 'react';\r\n\r\nimport { Cell } from '..';\r\n\r\nimport './Field.scss';\r\n\r\nexport const Field = ({ width, disabled, field, cellRevealHandler, flagPlantingHandler, neighborsRevealHandler }) => {\r\n  const handleNeighborsReveal = ({ target, nativeEvent: { which } }, address) => {\r\n    if (!disabled) {\r\n      const handleMouseup = event => {\r\n        which !== event.which && neighborsRevealHandler(address);\r\n\r\n        target.removeEventListener('mouseup', handleMouseup);\r\n      };\r\n\r\n      target.addEventListener('mouseup', handleMouseup);\r\n    }\r\n  };\r\n\r\n  return <div\r\n    className={`field${disabled ? ' disabled' : ''}`}\r\n    style={{gridTemplateColumns: `repeat(${width}, 1fr)`}}\r\n    onContextMenu={event => { event.preventDefault(); }}\r\n  >\r\n    {field.map((cell, address) => <Cell\r\n      key={address}\r\n      cell={cell}\r\n      cellRevealHandler={() => { !disabled && cellRevealHandler(cell, address); }}\r\n      flagPlantingHandler={() => { !disabled && flagPlantingHandler(cell, address); }}\r\n      neighborsRevealHandler={event => { handleNeighborsReveal(event, address); }}\r\n    />)}\r\n  </div>;\r\n};\r\n","import React from 'react';\r\n\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\n\r\nimport './Footer.scss';\r\n\r\nexport const Footer = () => <footer>\r\n  <span>\r\n    Powered by\r\n    <a href='https://github.com/FakeMetalFan' target='_blank' rel='noopener noreferrer'>\r\n      <FontAwesomeIcon icon={['fab', 'github']} />\r\n    </a>\r\n    &copy;<span>{new Date().getFullYear()}</span>\r\n  </span>\r\n</footer>;\r\n","import React from 'react';\r\n\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\n\r\nimport './Header.scss';\r\n\r\nexport const Header = () => <header>\r\n  <span className='title'>Minesweeper</span>\r\n\r\n  <a href='https://github.com/FakeMetalFan/minesweeper' target='_blank' rel='noopener noreferrer'>\r\n    <FontAwesomeIcon icon={['fab', 'github']} />\r\n  </a>\r\n</header>;\r\n","export class CellAddressUtils {\r\n  _fieldWidth;\r\n\r\n  constructor(\r\n    fieldWidth\r\n  ) {\r\n    this._fieldWidth = fieldWidth;\r\n  }\r\n\r\n  to2DAddresses(address) {\r\n    const rowAddress = address % this._fieldWidth;\r\n\r\n    return [rowAddress, (address - rowAddress) / this._fieldWidth];\r\n  }\r\n\r\n  to1DAddress(rowAddress, colAddress) {\r\n    return colAddress * this._fieldWidth + rowAddress;\r\n  }\r\n}\r\n","import { isFlaggedCell, isMinedCell } from 'utils/check-cell';\r\n\r\nimport { CellAddressUtils } from './cell-address-utils';\r\n\r\nexport class CellNeighborsUtils {\r\n  _fieldWidth;\r\n  _fieldHeight;\r\n  _cellAddressUtils;\r\n\r\n  constructor(\r\n    fieldWidth,\r\n    fieldHeight\r\n  ) {\r\n    this._fieldWidth = fieldWidth;\r\n    this._fieldHeight = fieldHeight;\r\n    this._cellAddressUtils = new CellAddressUtils(fieldWidth);\r\n  }\r\n\r\n  canFloodFill(state, address) {\r\n    return !this.getAddresses(address).some(adr => {\r\n      const cell = state[adr];\r\n\r\n      return isMinedCell(cell) && !isFlaggedCell(cell);\r\n    });\r\n  }\r\n\r\n  getAddresses(address) {\r\n    const [rowAddress, colAddress] = this._cellAddressUtils.to2DAddresses(address);\r\n    const addresses = [];\r\n\r\n    for (let rowAddressOffset = -1; rowAddressOffset < 2; rowAddressOffset++)\r\n      for (let colAddressOffset = -1; colAddressOffset < 2; colAddressOffset++)\r\n        if (rowAddressOffset || colAddressOffset) {\r\n          const rowAddressAhead = rowAddress + rowAddressOffset;\r\n          const colAddressAhead = colAddress + colAddressOffset;\r\n\r\n          this._doesAddressExist(rowAddressAhead, this._fieldWidth)\r\n            && this._doesAddressExist(colAddressAhead, this._fieldHeight)\r\n              && addresses.push(this._cellAddressUtils.to1DAddress(rowAddressAhead, colAddressAhead));\r\n        }\r\n\r\n    return addresses;\r\n  }\r\n\r\n  getMinedCount(state, address) {\r\n    return this._getCountBy(state, address, isMinedCell);\r\n  }\r\n\r\n  canRevealNeighbors(state, address) {\r\n    return this.getMinedCount(state, address) === this._getCountBy(state, address, isFlaggedCell);\r\n  }\r\n\r\n  _getCountBy(state, address, criteria) {\r\n    return this.getAddresses(address).reduce((ac, adr) => criteria(state[adr]) ? ac + 1 : ac, 0);\r\n  }\r\n\r\n  _doesAddressExist(address, criteria) {\r\n    return -1 < address && address < criteria;\r\n  }\r\n}\r\n","import React, { useState } from 'react';\r\n\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\n\r\nimport { useInterval } from 'hooks';\r\n\r\nimport './Indicators.scss';\r\n\r\nexport const Indicators = ({ minesCount, smileyFaceClickHandler, isCountingSeconds, isBust, isVictory }) => {\r\n  const [secondsCount, setSecondsCount] = useState(0);\r\n\r\n  const formatCount = count => {\r\n    if (count < 1) return '000';\r\n    if (count < 10) return `00${count}`;\r\n    if (count < 100) return `0${count}`;\r\n\r\n    return `${count}`;\r\n  };\r\n\r\n  const handleSmileyFaceClick = () => {\r\n    setSecondsCount(0);\r\n    smileyFaceClickHandler();\r\n  };\r\n\r\n  useInterval(() => {\r\n    setSecondsCount(secondsCount + 1);\r\n  }, isCountingSeconds ? 1e3 : null);\r\n\r\n  return <div className='indicators'>\r\n    <div className='mines-count'>{formatCount(minesCount)}</div>\r\n    <div className='smiley-face' onClick={handleSmileyFaceClick}>\r\n      <FontAwesomeIcon icon={['far', isVictory ? 'smile' : isBust ? 'frown' : 'meh']} />\r\n    </div>\r\n    <div className='timer'>{formatCount(secondsCount)}</div>\r\n  </div>;\r\n};\r\n","import { useEffect, useRef } from 'react';\r\n\r\nexport const useInterval = (fn, delay) => {\r\n  const fnRef = useRef();\r\n\r\n  useEffect(() => {\r\n    fnRef.current = fn;\r\n  }, [fn])\r\n\r\n  useEffect(() => {\r\n    if (delay) {\r\n      const intervalId = setInterval(() => {\r\n        fnRef.current();\r\n      }, delay);\r\n\r\n      return () => {\r\n        clearInterval(intervalId);\r\n      };\r\n    }\r\n  }, [delay]);\r\n};\r\n","import React, { useState } from 'react';\r\n\r\nimport reject from 'lodash/reject';\r\n\r\nimport { useField, useDidUpdate } from 'hooks';\r\n\r\nimport { isBustedCell, isFlaggedCell, isHiddenCell, isMinedCell } from 'utils/check-cell';\r\n\r\nimport { Field, Indicators } from '..';\r\n\r\nimport './Minesweeper.scss';\r\n\r\nexport const Minesweeper = ({ minesCount, fieldDimension }) => {\r\n  const [isInit, setIsInit] = useState(false);\r\n  const [isBust, setIsBust] = useState(false);\r\n  const [isVictory, setIsVictory] = useState(false);\r\n  const [hiddenMinesCount, setHiddenMinesCount] = useState(minesCount);\r\n\r\n  const {\r\n    field,\r\n    reset,\r\n    init,\r\n    revealCell,\r\n    plantFlag,\r\n    revealNeighbors,\r\n    markMines,\r\n  } = useField({ minesCount, width: fieldDimension, height: fieldDimension });\r\n\r\n  const handleCellReveal = (cell, address) => {\r\n    if (isInit) revealCell(cell, address);\r\n    else {\r\n      init(address);\r\n      setIsInit(true);\r\n    }\r\n  };\r\n\r\n  const handleFlagPlanting = (cell, address) => {\r\n    plantFlag(cell, address);\r\n    setHiddenMinesCount(hiddenMinesCount + (isFlaggedCell(cell) ? 1 : -1));\r\n  };\r\n\r\n  const handleSmileyFaceClick = () => {\r\n    reset();\r\n    setIsInit(false);\r\n    setIsBust(false);\r\n    setIsVictory(false);\r\n    setHiddenMinesCount(minesCount);\r\n  };\r\n\r\n  useDidUpdate(() => {\r\n    if (field.some(isBustedCell)) setIsBust(true);\r\n    else if (!reject(field, isMinedCell).some(isHiddenCell)) {\r\n      markMines();\r\n      setIsVictory(true);\r\n    }\r\n  }, field);\r\n\r\n  return <div className='minesweeper'>\r\n    <Indicators\r\n      minesCount={hiddenMinesCount}\r\n      isBust={isBust}\r\n      isVictory={isVictory}\r\n      isCountingSeconds={isInit && !(isBust || isVictory)}\r\n      smileyFaceClickHandler={handleSmileyFaceClick}\r\n    />\r\n    <Field\r\n      width={fieldDimension}\r\n      disabled={isBust || isVictory}\r\n      field={field}\r\n      cellRevealHandler={handleCellReveal}\r\n      flagPlantingHandler={handleFlagPlanting}\r\n      neighborsRevealHandler={revealNeighbors}\r\n    />\r\n  </div>;\r\n};\r\n","import { useState, useMemo } from 'react';\r\n\r\nimport produce from 'immer';\r\n\r\nimport difference from 'lodash/difference';\r\nimport range from 'lodash/range';\r\n\r\nimport { cellState, cellValue } from 'const';\r\n\r\nimport { CellNeighborsUtils } from 'view-models';\r\n\r\nimport { isMinedCell, isHiddenCell, isFlaggedCell } from 'utils/check-cell';\r\n\r\nexport const useField = ({ width, height, minesCount }) => {\r\n  const length = width * height;\r\n\r\n  const cellNeighborsUtils = useMemo(() => new CellNeighborsUtils(width, height), [length]);\r\n  const emptyField = useMemo(() => Array(length).fill({ value: cellValue.Empty, state: cellState.Hidden }), [length]);\r\n\r\n  const [field, setField] = useState(emptyField);\r\n\r\n  const getFloodFilledField = (address, draftFn) => produce(field, draft => {\r\n    /* eslint-disable-line */ draftFn?.(draft);\r\n    draft[address].state = cellState.Visible;\r\n\r\n    const floodFill = cellAdr => {\r\n      cellNeighborsUtils.canFloodFill(draft, cellAdr) && cellNeighborsUtils.getAddresses(cellAdr).forEach(adr => {\r\n        const cell = draft[adr];\r\n\r\n        if (!isMinedCell(cell) && isHiddenCell(cell) && !isFlaggedCell(cell)) {\r\n          cell.state = cellState.Visible;\r\n\r\n          floodFill(adr);\r\n        }\r\n      });\r\n    };\r\n\r\n    floodFill(address);\r\n  });\r\n\r\n  const getBustedField = draftFn => produce(field, draft => {\r\n    draftFn(draft);\r\n    draft.forEach((cell, adr) => {\r\n      isMinedCell(cell) && !isFlaggedCell(cell) && (cell.state = cellState.Visible);\r\n      !isMinedCell(cell) && isFlaggedCell(cell) && (draft[adr] = {\r\n        value: cellValue.IncorrectGuess,\r\n        state: cellState.Visible,\r\n      });\r\n    });\r\n  });\r\n\r\n  const reset = () => {\r\n    setField(emptyField);\r\n  };\r\n\r\n  const init = address => {\r\n    setField(getFloodFilledField(address, draft => {\r\n      const addresses = difference(range(length), [address, ...cellNeighborsUtils.getAddresses(address)]);\r\n      const randomAddresses = new Set;\r\n\r\n      while (randomAddresses.size < minesCount) randomAddresses.add(addresses[Math.random() * addresses.length | 0]);\r\n\r\n      randomAddresses.forEach(adr => {\r\n        draft[adr].value = cellValue.Mine;\r\n      });\r\n\r\n      draft.forEach((cell, adr) => {\r\n        !isMinedCell(cell) && (cell.value = cellNeighborsUtils.getMinedCount(draft, adr));\r\n      });\r\n    }));\r\n  };\r\n\r\n  const revealCell = (cell, address) => {\r\n    setField(isMinedCell(cell) ? getBustedField(draft => {\r\n      draft[address] = { value: cellValue.BustedMine, state: cellState.Visible };\r\n    }) : getFloodFilledField(address));\r\n  };\r\n\r\n  const plantFlag = (cell, address) => {\r\n    setField(produce(field, draft => {\r\n      draft[address].state = cellState[isFlaggedCell(cell) ? 'Hidden' : 'Flagged'];\r\n    }));\r\n  };\r\n\r\n  const revealNeighbors = address => {\r\n    if (cellNeighborsUtils.canFloodFill(field, address)) setField(getFloodFilledField(address));\r\n    else if (cellNeighborsUtils.canRevealNeighbors(field, address)) setField(getBustedField(draft => {\r\n      cellNeighborsUtils.getAddresses(address).forEach(adr => {\r\n        const cell = draft[adr];\r\n\r\n        isMinedCell(cell) && !isFlaggedCell(cell) && (cell.value = cellValue.BustedMine);\r\n        !isMinedCell(cell) && isFlaggedCell(cell) && (cell.value = cellValue.IncorrectGuess);\r\n\r\n        cell.state = cellState.Visible;\r\n      });\r\n    }));\r\n  };\r\n\r\n  const markMines = () => {\r\n    setField(produce(field, draft => {\r\n      draft.forEach(cell => {\r\n        isMinedCell(cell) && (cell.state = cellState.Flagged);\r\n      });\r\n    }));\r\n  };\r\n\r\n  return { field, reset, init, revealCell, plantFlag, revealNeighbors, markMines };\r\n};\r\n","import { useEffect, useRef } from 'react';\r\n\r\nexport const useDidUpdate = (fn, ...deps) => {\r\n  const fnRef = useRef();\r\n  const didMount = useRef(false);\r\n\r\n  useEffect(() => {\r\n    fnRef.current = fn;\r\n  }, [fn]);\r\n\r\n  useEffect(() => {\r\n    if (didMount.current) fnRef.current();\r\n    else didMount.current = true;\r\n  }, deps);\r\n};\r\n","import React from 'react';\r\n\r\nimport { Header, Minesweeper, Footer } from 'components';\r\n\r\nexport const App = () => <>\r\n  <Header />\r\n  <Minesweeper minesCount={30} fieldDimension={16} />\r\n  <Footer />\r\n</>;\r\n","import { library } from '@fortawesome/fontawesome-svg-core'\r\nimport { faGithub } from '@fortawesome/free-brands-svg-icons';\r\nimport { faFlag, faMeh, faFrown, faSmile } from '@fortawesome/free-regular-svg-icons';\r\nimport { faBomb } from '@fortawesome/free-solid-svg-icons';\r\n\r\nexport const setupIcons = () => {\r\n  library.add(faGithub, faBomb, faFlag, faMeh, faFrown, faSmile);\r\n};\r\n","import React, { StrictMode }  from 'react';\r\nimport { render } from 'react-dom';\r\n\r\nimport { App } from 'App';\r\n\r\nimport { setupIcons } from 'setupIcons';\r\n\r\nimport 'index.scss';\r\n\r\nsetupIcons();\r\n\r\nrender(\r\n  <StrictMode>\r\n    <App />\r\n  </StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}